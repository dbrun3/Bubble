<template>
    <div>
        <GMapMap class = "map"
            ref="mapRef"
            :center="center"
            :zoom="13"
            :options="options"
            style="width: 100vw; height: 100vh">

            <GMapMarker
                :key="index"
                v-for="(b, index) in bubbles"
                :position="b.loc"
                :clickable="true"
                :icon="this.addBubble(b.msg, b.style)"
                />
        </GMapMap>
    </div>
</template>
<script>

    const default_bubble = '<svg id="Layer_2" data-name="Layer 2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1342.45 1057.81">  <defs>    <style>      .cls-1, .cls-2 {        fill: #000;      }      .cls-1, .cls-3, .cls-4 {        stroke-width: 0px;      }      .cls-2 {        font-family: ComicSansMS, "Comic Sans MS";        font-size: 135px;      }      .cls-3 {        fill: #fff;      }      .cls-4 {        fill: #292627;      }    </style>  </defs>  <g id="_eie_2" data-name="eie_2">    <g>      <path class="cls-3" d="M640.88,707.68c78.22-2.05,135.53-.49,182.44-.49,128.66,0,333.43-9.32,435.42-95.3,60.1-50.67,67.19-152.11,67.19-266.21,0-96.17-14.53-201.04-76.96-254.71C1170.82,23.76,975.43,11.02,806.96,11.02s-333.7.15-437.18,79.94c-90.19,69.54-98.02,235.82-98.02,310.89,0,69.88,5.05,215.35,90.91,263.77,33.59,18.94,77.96,28.3,126.76,32.1l-49.98,200.3,201.42-190.34Z"/>      <path class="cls-1" d="M439.45,909.03c-1.91,0-3.83-.49-5.56-1.51-4.22-2.47-6.31-7.43-5.13-12.18l46.86-187.8c-49.88-4.99-88.69-15.61-118.36-32.34-39.97-22.54-67.88-66.59-82.97-130.92-12.14-51.79-13.55-106.1-13.55-142.44,0-109.82,17.75-254.41,102.31-319.61,48.05-37.05,113.3-60.63,199.5-72.08C638.86,0,724.32,0,806.96,0c237.61,0,391.89,27.02,456.53,82.6,54.37,46.74,78.96,132.79,78.96,263.07,0,108.63-14.67,219.32-80.29,274.63-78.14,65.88-219.21,105.24-438.85,105.24-13.14,0-27.17-.12-42.02-.25-38.35-.33-89.03-2.55-143.26-1.2l-191.01,181.93c-2.1,1.98-4.82,3.01-7.57,3.01ZM806.96,18.36c-81.93,0-166.64-3.67-241.51,6.28-82.24,10.93-151.64,32.82-199.96,75.04-35.16,30.71-56.14,77.98-71.46,147.03-9.9,44.65-11.25,96.84-11.25,155.13,0,35.25,1.34,87.85,12.97,137.41,13.62,58.09,37.96,97.37,72.34,116.76,29.33,16.54,69.3,26.59,122.2,30.72,3.23.25,6.19,1.91,8.08,4.54,1.9,2.63,2.54,5.96,1.75,9.11l-40.86,163.76,174.05-164.47c1.97-1.86,4.57-2.93,7.28-3.01,56.59-1.48,101.38-1.1,140.9-.75,14.8.13,28.79.25,41.83.25,214.22,0,354.32-30.33,428.32-92.71,58.39-49.23,63.27-154.34,63.27-257.79,0-121.76-24.6-204.64-73.12-246.36-33.65-28.93-94.72-49.99-181.54-62.62-67.82-9.86-150.68-18.33-253.29-18.33Z"/>    </g>    <text id="text" text-anchor="middle" letter-spacing="12" class="cls-2" transform="translate(420.6 222.57) scale(.95 1)"><tspan x="420" y="0">line1</tspan><tspan x="420" y="130">line2</tspan><tspan x="420" y="260">line3</tspan></text>  </g></svg>';
    const round_bubble = '<svg id="Layer_2" data-name="Layer 2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1387.71 1063.16">  <defs>    <style>      .cls-1 {        font-family: ComicSansMS, "Comic Sans MS";        font-size: 135px;              fill: #000;      }      .cls-1, .cls-2, .cls-3 {        stroke-width: 0px;      }      .cls-2 {        fill: #fff;      }      .cls-3 {        fill: #292627;      }    </style>  </defs>  <g id="_eie_2" data-name="eie_2">    <g>      <path class="cls-2" d="M647.6,642.81c54.01,10.67,111.63,16.44,171.45,16.44,307.95,0,557.6-152.82,557.6-341.34S1127,12.89,819.05,12.89,261.45,129.39,261.45,317.91c0,100.25,70.59,190.4,183,252.84l-32.83,203.61,235.98-131.55Z"/>      <path class="cls-1" d="M411.62,785.43c-2.23,0-4.45-.67-6.35-2-3.48-2.43-5.25-6.64-4.58-10.83l31.6-196c-55.24-31.68-99.09-69.17-130.4-111.52-34.18-46.23-51.51-95.75-51.51-147.18,0-95.18,43.49-172.15,168.61-234.46C553.24,16.58,668.09,0,819.05,0s277.34,18.96,400.06,83.45c112.85,59.3,168.61,139.29,168.61,234.46s-59.88,184.25-168.61,250.81c-107.03,65.52-249.11,101.61-400.06,101.61-57.87,0-114.9-5.34-169.59-15.87l-232.44,129.58c-1.68.94-3.54,1.4-5.39,1.4ZM819.05,23.96c-301.36,0-539.27,111.84-539.27,293.96,0,46.58,8.61,91.67,39.92,134.02,30.69,41.51,74.47,78.23,130.13,109.15,4.08,2.26,6.3,6.84,5.55,11.44l-29.19,181.05,216.02-120.43c2.29-1.28,4.97-1.7,7.54-1.19,54.5,10.77,111.46,16.23,169.3,16.23,301.36,0,555.61-139.08,555.61-321.19S1120.4,23.96,819.05,23.96Z"/>    </g>      <text id="text" text-anchor="middle" letter-spacing="12" class="cls-1" transform="translate(420.6 222.57) scale(.95 1)"><tspan x="420" y="0">line1</tspan><tspan x="420" y="130">line2</tspan><tspan x="420" y="260">line3</tspan></text>  </g></svg>';
    const thought_bubble = '<svg id="Layer_2" data-name="Layer 2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1146.33 1086.4">  <defs>    <style>      .cls-1 {        fill: #000;        font-family: ComicSansMS, "Comic Sans MS";        font-size: 110px;            }      .cls-1, .cls-2, .cls-3 {        stroke-width: 0px;      }      .cls-2 {        fill: #fff;      }      .cls-3 {        fill: #292627;      }    </style>  </defs>  <g id="_eie_2" data-name="eie_2">    <path class="cls-2" d="M808.63,98.3c19.33-13.6,42.14-22.86,67.19-26.16,82.84-10.93,158.86,47.37,169.78,130.21,2.93,22.17.89,43.85-5.24,63.93l1.09.33c53.8,17.01,95.7,63.82,103.57,123.45,10.83,82.12-46.96,157.48-129.08,168.31-28.87,3.81-56.91-.86-81.6-12.1l.12.92c.25,1.54.47,3.09.68,4.65,11.92,90.37-51.67,173.3-142.04,185.22-70.76,9.34-136.96-27.63-168.08-87.5l-.41.67c-18.88,30.45-50.76,52.5-89.05,57.55-67.78,8.94-129.97-38.75-138.91-106.53-1.29-9.79-1.4-19.47-.44-28.88l-3.31.47c-88.76,11.71-170.2-50.75-181.91-139.51-9.07-68.74,26.35-133.09,84.02-164.06l-.09-.18c-18.62-40.93-14.62-90.54,14.65-128.71,42.26-55.11,121.2-65.53,176.31-23.26l1.17.82.8-2.18c20.1-61.12,74.09-105.28,142.14-114.26,75.1-9.91,145.3,29.97,177.34,94.14l1.29,2.65Z"/>    <g>      <path class="cls-1" d="M652.83,19.65c28.58,0,56.55,8.03,80.89,23.23,24.04,15.01,43.4,36.27,56.01,61.47l1.24,2.55,10.1,20.75,18.87-13.28c17.46-12.28,37.12-19.94,58.45-22.75,5.77-.76,11.63-1.15,17.41-1.15,31.63,0,62.27,11.5,86.27,32.39,24.21,21.06,39.85,50.21,44.05,82.06,2.49,18.87.96,37.58-4.55,55.62l-5.75,18.81,18.82,5.73.98.3c23.28,7.38,43.99,21.12,59.91,39.74,16.33,19.12,26.71,42.46,30.02,67.52,4.55,34.52-4.61,68.74-25.79,96.36-21.19,27.63-51.86,45.35-86.38,49.9-5.72.75-11.52,1.14-17.24,1.14-18.63,0-36.68-3.92-53.66-11.64l-32.25-14.67,4.64,35.12.12.92.04.27.04.27c.22,1.36.42,2.74.6,4.11,2.57,19.47,1.25,38.85-3.92,57.6-5,18.12-13.36,34.91-24.86,49.9-11.5,14.99-25.54,27.42-41.75,36.95-16.77,9.85-35.14,16.15-54.61,18.72-6.38.84-12.85,1.27-19.23,1.27-26.71,0-52.91-7.41-75.77-21.44-22.58-13.86-40.94-33.54-53.09-56.91l-16.05-30.88-18.15,29.7-.38.62c-16.54,26.64-43.84,44.27-74.89,48.37-4.57.6-9.21.91-13.78.91-25.02,0-49.25-9.1-68.24-25.62-19.15-16.66-31.52-39.71-34.85-64.91-1.07-8.1-1.19-16.28-.37-24.31l2.55-24.98-24.86,3.53-3.21.46c-6.22.82-12.52,1.23-18.74,1.23-34.23,0-67.38-12.45-93.36-35.05-26.19-22.79-43.12-54.33-47.67-88.79-3.86-29.25,1.3-58.48,14.91-84.52,6.57-12.56,14.94-24.05,24.89-34.15,10.04-10.19,21.49-18.78,34.03-25.51l16.34-8.77-7.82-16.82-.05-.11c-16.25-35.8-11.51-77.38,12.39-108.54,10.22-13.32,23.01-23.75,38.01-30.98,14.32-6.91,30.33-10.56,46.28-10.56,23.48,0,45.78,7.58,64.48,21.91l.35.27.37.25,1.17.82,20.86,14.54,8.81-23.85.8-2.18.12-.33.11-.34c8.72-26.51,24.89-49.86,46.77-67.54,22.19-17.93,49.6-29.47,79.28-33.38,6.72-.89,13.54-1.34,20.26-1.34M652.83,0c-7.54,0-15.16.49-22.83,1.51-68.05,8.98-122.04,53.14-142.14,114.26l-.8,2.18-1.17-.82c-22.83-17.51-49.73-25.97-76.43-25.97-37.77,0-75.12,16.95-99.88,49.23-29.27,38.17-33.28,87.78-14.65,128.71l.09.18c-57.67,30.97-93.09,95.32-84.02,164.06,10.76,81.56,80.41,140.92,160.51,140.92,7.06,0,14.21-.46,21.41-1.41l3.31-.47c-.96,9.41-.85,19.09.44,28.88,8.22,62.28,61.4,107.61,122.57,107.61,5.39,0,10.85-.35,16.35-1.08,38.29-5.05,70.17-27.1,89.05-57.55l.41-.67c27.9,53.67,83.99,88.94,146.28,88.94,7.19,0,14.47-.47,21.8-1.44,90.37-11.92,153.97-94.85,142.04-185.22-.21-1.56-.43-3.11-.68-4.65l-.12-.92c19,8.64,39.98,13.4,61.79,13.4,6.54,0,13.15-.43,19.81-1.31,82.12-10.83,139.91-86.19,129.08-168.31-7.87-59.64-49.77-106.45-103.57-123.45l-1.09-.33c6.14-20.08,8.17-41.76,5.24-63.93-10.04-76.13-75.05-131.52-149.8-131.52-6.59,0-13.27.43-19.98,1.32-25.05,3.31-47.86,12.56-67.19,26.16l-1.29-2.65C778.57,38.03,719.05,0,652.83,0h0Z"/>      <ellipse class="cls-2" cx="376.95" cy="804.57" rx="85.38" ry="62.28"/>      <ellipse class="cls-2" cx="264.75" cy="957.72" rx="53.89" ry="39.34"/>      <path class="cls-1" d="M376.95,761.94c18.41,0,36.19,5.78,48.79,15.85,6.33,5.05,16.94,15.79,16.94,30.85s-10.61,25.8-16.94,30.85c-12.6,10.07-30.39,15.85-48.79,15.85s-36.19-5.78-48.8-15.85c-6.33-5.06-16.94-15.78-16.94-30.85s10.61-25.8,16.94-30.85c12.6-10.07,30.39-15.85,48.8-15.85M376.95,742.29c-47.15,0-85.38,27.88-85.38,62.28s38.23,62.28,85.38,62.28,85.38-27.88,85.38-62.28-38.23-62.28-85.38-62.28h0Z"/>      <path class="cls-1" d="M264.75,938.03c22.45,0,39.23,13.77,39.23,26.09s-16.78,26.09-39.23,26.09-39.22-13.78-39.22-26.09,16.77-26.09,39.22-26.09M264.75,918.38c-29.76,0-53.89,17.61-53.89,39.34s24.13,39.34,53.89,39.34,53.89-17.61,53.89-39.34-24.13-39.34-53.89-39.34h0Z"/>    </g>    <path class="cls-2" d="M1099.73,485.99c21.2-27.74,30.37-62.1,25.81-96.75-3.31-25.16-13.7-48.6-30.04-67.79-15.92-18.7-36.65-32.49-59.95-39.9l-.98-.3-18.83-5.75,5.75-18.89c5.52-18.11,7.05-36.9,4.56-55.84-4.21-31.98-19.86-61.24-44.09-82.39-24.02-20.97-54.69-32.52-86.34-32.52-5.78,0-11.65.39-17.42,1.15-21.35,2.83-41.03,10.51-58.5,22.84l-18.89,13.33-10.11-20.83-1.24-2.56c-12.61-25.3-31.99-46.64-56.05-61.71-24.36-15.26-52.35-23.33-80.95-23.33-6.73,0-13.56.45-20.28,1.34-29.7,3.93-57.13,15.52-79.34,33.52-21.9,17.74-38.08,41.19-46.81,67.81l-.11.34-.12.33-.81,2.19-8.82,23.94-20.87-14.6-1.17-.82-.37-.26-.35-.27c-18.71-14.4-41.03-22-64.53-22-15.97,0-31.99,3.67-46.32,10.6-15.01,7.26-27.81,17.73-38.04,31.11-23.92,31.29-28.67,73.04-12.4,108.98l.05.11,7.82,16.88-16.35,8.81c-12.55,6.76-24.01,15.38-34.06,25.61-9.96,10.14-18.34,21.68-24.91,34.29-13.63,26.15-18.79,55.49-14.93,84.86,4.55,34.6,21.49,66.26,47.71,89.15,25.99,22.69,59.17,35.19,93.43,35.19,6.22,0,12.53-.42,18.76-1.23l3.21-.46,24.88-3.55-2.55,25.08c-.82,8.07-.7,16.28.37,24.41,3.33,25.3,15.71,48.44,34.87,65.17,19,16.59,43.26,25.72,68.3,25.72,4.57,0,9.21-.31,13.79-.91,31.08-4.11,58.4-21.81,74.95-48.56l.38-.62,18.16-29.82,16.07,31.01c12.16,23.47,30.53,43.23,53.13,57.14,22.87,14.08,49.09,21.53,75.83,21.53,6.39,0,12.86-.43,19.24-1.27,19.48-2.58,37.87-8.9,54.66-18.8,16.22-9.56,30.28-22.04,41.78-37.09,11.51-15.05,19.88-31.91,24.88-50.1,5.17-18.83,6.49-38.28,3.92-57.83-.18-1.37-.38-2.76-.6-4.13l-.04-.27-.04-.27-.12-.93-4.64-35.26,32.27,14.73c16.99,7.75,35.06,11.68,53.7,11.68,5.72,0,11.53-.38,17.25-1.14,34.54-4.57,65.24-22.36,86.45-50.1Z"/>  <text id="text" text-anchor="middle" letter-spacing="12" class="cls-1" transform="translate(420.6 222.57) scale(.95 1)"><tspan x="270" y="50">line1</tspan><tspan x="270" y="150">line2</tspan><tspan x="270" y="250">line3</tspan></text>  </g></svg>';
    const loud_bubble = '<svg id="Layer_2" data-name="Layer 2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1209.57 1061.81">  <defs>    <style>      .cls-1 {        fill: #000;        font-family: ComicSansMS, "Comic Sans MS";        font-size: 110px;            }      .cls-1, .cls-2, .cls-3 {        stroke-width: 0px;      }      .cls-2 {        fill: #fff;      }      .cls-3 {        fill: #292627;      }    </style>  </defs>  <g id="_eie_2" data-name="eie_2">    <g>      <path class="cls-2" d="M439.12,0s134.43,346.59,298.53,0c0,0,5.82,265.65,265.65,83.38,0,0-137.67,271.46,172.57,337.39,0,0-292.79,29.09-153.18,318,0,0-246.26-252.07-304.43,87.26,0,0-101.83-292.64-332.8,71.2,0,0,145.71-364.07-181.58-222.32,0,0,168.68-176.87-72.38-250.26,0,0,292.12-22.19,90.48-243.5,0,0,253.34,100.82,217.15-181.15Z"/>      <g>        <path class="cls-1" d="M727.96,60.22c1.9,6.68,4.16,13.58,6.87,20.49,9.51,24.27,22.51,43.81,38.65,58.08,20.92,18.5,46.59,27.87,76.29,27.87,22.13,0,46.72-5.34,73.07-15.87,13.56-5.41,27.79-12.29,42.61-20.56-1.75,6.33-3.43,13.07-4.95,20.14-5.54,25.84-7.83,50.96-6.8,74.67,1.32,30.2,8.04,58.18,19.98,83.16,14.81,30.97,37.72,57.5,68.09,78.86,17.63,12.4,37.95,23.14,60.77,32.17-.31.12-.63.24-.94.36-22.95,8.69-43.53,19.6-61.16,32.45-22.56,16.43-40.33,36.06-52.81,58.33-16.22,28.94-23.56,62.38-21.82,99.39.99,21,4.93,43.34,11.79,66.86-19.31-13.27-38.37-23.92-56.7-31.68-24.46-10.35-47.81-15.61-69.42-15.61-17.47,0-33.98,3.43-49.09,10.2-16.49,7.39-31.45,18.84-44.47,34.02-13.51,15.75-25.24,35.93-34.86,59.97-5.2,12.99-9.87,27.33-13.98,42.89-4.07-5.33-8.58-10.86-13.5-16.41-14.97-16.87-30.71-30.4-46.8-40.22-21.14-12.91-42.94-19.45-64.77-19.45-28.21,0-56.02,10.89-82.66,32.36-13.4,10.8-26.74,24.51-39.68,40.77-.5-15.08-40.72,64.43-43.61,51.41,23.88-73.23,23.97-127.94,12.39-151.74-11.2-14.27-25.32-25.33-41.97-32.88-17.87-8.1-38.88-12.21-62.45-12.21-17.7,0-37.29,2.33-58.22,6.91-4.43.97-8.95,2.05-13.55,3.24,18.12-31.88,33.93-75.19,22.51-118.69-9.45-35.98-35.51-65.53-77.74-88.29,1.92-.57,3.86-1.16,5.81-1.78,22.4-7.11,41.7-16.13,57.37-26.79,20.89-14.23,35.48-31.48,43.34-51.28,9.55-24.04,9.01-51.2-1.6-80.73-5.48-15.27-13.81-31.46-24.73-48.14-1.69-2.59-3.46-5.19-5.29-7.83,12.63,2.02,26.51,3.4,40.82,3.4,20.96,0,40.19-2.99,57.16-8.87,20.93-7.26,38.6-18.97,52.52-34.79,15.85-18.01,26.82-41.41,32.62-69.54,1.46-7.09,2.6-14.53,3.42-22.3,1.15,1.76,2.32,3.53,3.51,5.3,16.19,23.98,33.26,43.24,50.75,57.24,23.47,18.79,47.9,28.32,72.58,28.32,29,0,57.47-13.14,84.62-39.05,14-13.37,27.97-30.47,41.5-50.83,4.85-7.29,9.69-15.08,14.52-23.33M737.65,0c-54.71,115.55-106.1,154.04-150.33,154.04C498.87,154.04,439.12,0,439.12,0c21.1,164.41-56.22,198.67-124.37,198.67-48.73,0-92.78-17.53-92.78-17.53,201.64,221.32-90.48,243.5-90.48,243.5,241.06,73.39,72.38,250.26,72.38,250.26,50.43-19.4,90.46-27.48,122.18-27.47,186.72-18.03,18.44,322.8,18.44,322.8,54.09-97.91,186.67-266.16,239.53-250.51,79.87,0,134.23,106.3,134.23,106.3,23.4-136.53,77.24-177.32,133.25-177.31,83.2.01,171.18,90.05,171.18,90.05-139.61-288.92,153.18-318,153.18-318-310.25-65.93-172.57-337.39-172.57-337.39-66.39,46.57-116.16,63.89-153.53,63.89-108.87,0-112.12-147.27-112.12-147.27h0Z"/>        <g>          <polygon class="cls-1" points="1067.56 237.28 1138.71 169.98 1173.08 182.51 1067.56 237.28"/>          <polygon class="cls-1" points="1096.77 253.82 1209.2 213.03 1209.57 244.33 1096.77 253.82"/>        </g>        <g>          <polygon class="cls-1" points="186.41 318.43 67.96 303.61 69.06 273.09 186.41 318.43"/>          <polygon class="cls-1" points="174.49 288.75 55.3 218.43 88.11 206.26 174.49 288.75"/>        </g>        <g>          <polygon class="cls-1" points="865.4 757.63 947.77 785.39 941.24 822.06 865.4 757.63"/>          <polygon class="cls-1" points="857.24 780.15 932.15 876.63 888.23 871.59 857.24 780.15"/>        </g>      </g>    </g>  <text id="text" text-anchor="middle" letter-spacing="12" class="cls-1" transform="translate(420.6 222.57) scale(.95 1)"><tspan x="220" y="100">line1</tspan><tspan x="220" y="230">line2</tspan><tspan x="220" y="360">line3</tspan></text>  </g></svg>';
    const styles = [default_bubble, round_bubble, thought_bubble, loud_bubble];


    export default {
        name: "Map",

        props: {
            user_lat: Number,
            user_lng: Number,
        },

        mounted() {
            this.$emit('map-loaded');
        },

        data() {
            return {
                center : { lat: this.user_lat, lng: this.user_lng },
                options : { mapId: "370b58f4df099767", mapTypeControl: false,
                            fullscreenControl:false,streetViewControl:false, disableDefaultUI: true,},
                bubbles: [],
            };
        },
        methods: {

            formatMsg(msg) {
                const tokens = msg.split(' ');
                var line = ""
                var lineNum = 0;
                var arr = [];

                tokens.forEach(function(token) {
                    if((line + token).length < 11) {
                        line += " " + token;
                    } else {

                        if(token.length > 11) {

                        }

                        arr.push(line);
                        line = token;
                        lineNum++;
                    }
                });
                arr.push(line);
                for(let i = lineNum + 1; i < 4; i++) {
                    arr.push(" ");
                }
                return arr;
            },
            // Generate new bubble icon from string
            addBubble(msg, style) {     
                const text = this.formatMsg(msg);
                const svg = styles[style];
                return { url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(svg).replace("line1", text[0]).replace("line2", text[1]).replace("line3", text[2]).replace("line4", text[3]), scaledSize: new google.maps.Size(120,120), anchor: new google.maps.Point(30,100)}
            },

            // Get array of bubbles
            inputBubbles(data) {
                this.bubbles = data;
            }
        }
    };
</script>